import os
import sys

from PyQt5.QtCore import QUrl


def check_admin_password(window):
    # import the variable from the password form as "password"
    password = window.get_input("Enter Password:")
    pass_fail = True

    filepath = 'common_password_list'
    filepath = resource_path(filepath)
    with open(filepath) as fp:
        for test, line in enumerate(fp):
            line = fp.readline()
            #remove troublesome whitespace characters
            line = line.rstrip('\n')
            if(line == password):
                pass_fail = False
                break

    if not pass_fail:
        link = "<a href='https://support.microsoft.com/en-us/help/4490115/windows-change-or-reset-your-password'>Link</a>"
        output = (False, "Your Administrator password matches on of the top 500 most common passwords. "
                  "Follow the steps here: {}, "
                  "to change it to something more secure.".format(link))
    else:
        output = (True, "Your Administrator password does not match the top 500 most common passwords. Passed test.")

    return output

def resource_path(relative_path):
    try:
        base_path = sys._MEIPASS
    except Exception:
        base_path = os.environ.get("_MEIPASS2",os.path.abspath("."))

    return os.path.join(base_path, relative_path)

